/*****************************************************************
|
|   whiteCryption Secure Key Box
|
|   $Id: SkbDukpt.h 18985 2022-12-29 13:38:40Z kristaps.straupe $
|
|   This software is provided to you pursuant to your Software
|   license agreement (SLA) with whiteCryption Corporation
|   ("whiteCryption"). This software may be used only in accordance
|   with the terms of this agreement.
|
|   Copyright (c) 2000-2023, whiteCryption Corporation. All rights reserved.
|
****************************************************************/

#ifndef SKB_Byte
    #define SKB_Byte l5b64b69185ec3de22a96ba7236cd3eb14edaf4dd6dd0b5d4
#endif
#ifndef SKB_DUKPT_DERIVATION_FUNCTION_AES128
    #define SKB_DUKPT_DERIVATION_FUNCTION_AES128 l4cbe0f6986674d859a5ac39c4f40712220f2e6bf3bf0576d
#endif
#ifndef SKB_DUKPT_DERIVATION_FUNCTION_AES192
    #define SKB_DUKPT_DERIVATION_FUNCTION_AES192 l3fcf2c97dc71334e15a09bc4e2dfe6d7ca260278bfc3d3bb
#endif
#ifndef SKB_DUKPT_DERIVATION_FUNCTION_AES256
    #define SKB_DUKPT_DERIVATION_FUNCTION_AES256 l742e889b7c4888bc573f4605f4eb027cf9affdfd41da5345
#endif
#ifndef SKB_DUKPT_KSN_AES_MODE
    #define SKB_DUKPT_KSN_AES_MODE l165681594fc0d00d0cbf7fd6edb414efd644ae94b7645d77
#endif
#ifndef SKB_DUKPT_KSN_COMPATIBILITY_MODE
    #define SKB_DUKPT_KSN_COMPATIBILITY_MODE l468f42f33737f85e540724105db195fc4884e4f03609bde4
#endif
#ifndef SKB_DUKPT_WORKING_KEY_TYPE_AES128
    #define SKB_DUKPT_WORKING_KEY_TYPE_AES128 l4c850b4506192519f8c11341094d25cccf73f22c3b0fba6a
#endif
#ifndef SKB_DUKPT_WORKING_KEY_TYPE_AES192
    #define SKB_DUKPT_WORKING_KEY_TYPE_AES192 l0d53b752495ae70d3f3788f3662464edb0177dac50f1f203
#endif
#ifndef SKB_DUKPT_WORKING_KEY_TYPE_AES256
    #define SKB_DUKPT_WORKING_KEY_TYPE_AES256 ld3d69c410a2db714e9fc1a01e5e2289e832c30f7b9e265b6
#endif
#ifndef SKB_DUKPT_WORKING_KEY_TYPE_HMAC128
    #define SKB_DUKPT_WORKING_KEY_TYPE_HMAC128 l19732907064a6ed32b4bfd23a9f3fd01d047ed5ae230a39c
#endif
#ifndef SKB_DUKPT_WORKING_KEY_TYPE_HMAC192
    #define SKB_DUKPT_WORKING_KEY_TYPE_HMAC192 l81eea6f773311951d438ddae6a9dd247087dd3580b949797
#endif
#ifndef SKB_DUKPT_WORKING_KEY_TYPE_HMAC256
    #define SKB_DUKPT_WORKING_KEY_TYPE_HMAC256 l6d41c8acd9a995f0ec347221dcb5bf619ffb35ab78845413
#endif
#ifndef SKB_DUKPT_WORKING_KEY_TYPE_TDEA2
    #define SKB_DUKPT_WORKING_KEY_TYPE_TDEA2 l7b6124463dd10f81e529b129190fcd2126c324e9b5bb94bd
#endif
#ifndef SKB_DUKPT_WORKING_KEY_TYPE_TDEA3
    #define SKB_DUKPT_WORKING_KEY_TYPE_TDEA3 l9681f9218450db42d1c0c6ec24182163f997bff5d2b2918c
#endif
#ifndef SKB_DUKPT_WORKING_KEY_USAGE_DATA_ENCRYPTION_BOTHWAYS
    #define SKB_DUKPT_WORKING_KEY_USAGE_DATA_ENCRYPTION_BOTHWAYS lc6572523aa2254217399c8d91c20f8d89f42cccd8673092f
#endif
#ifndef SKB_DUKPT_WORKING_KEY_USAGE_DATA_ENCRYPTION_DECRYPT
    #define SKB_DUKPT_WORKING_KEY_USAGE_DATA_ENCRYPTION_DECRYPT l2adccf6b1beceb29a7cde4c9c9e38fd116cf9f90d26993a3
#endif
#ifndef SKB_DUKPT_WORKING_KEY_USAGE_DATA_ENCRYPTION_ENCRYPT
    #define SKB_DUKPT_WORKING_KEY_USAGE_DATA_ENCRYPTION_ENCRYPT l52773be9a6d4bb856503e159fc64e2789650a3cd8e45ab89
#endif
#ifndef SKB_DUKPT_WORKING_KEY_USAGE_KEY_DERIVATION
    #define SKB_DUKPT_WORKING_KEY_USAGE_KEY_DERIVATION lbd9c2b3af2ceda624a2600b954e954839b2cd16eceb9d069
#endif
#ifndef SKB_DUKPT_WORKING_KEY_USAGE_KEY_ENCRYPTION_KEY
    #define SKB_DUKPT_WORKING_KEY_USAGE_KEY_ENCRYPTION_KEY lf8d64f506b7a714909332d14fd00d86545d41fbe3edd2e71
#endif
#ifndef SKB_DUKPT_WORKING_KEY_USAGE_MESSAGE_AUTHENTICATION_BOTHWAYS
    #define SKB_DUKPT_WORKING_KEY_USAGE_MESSAGE_AUTHENTICATION_BOTHWAYS l6b68f1cc8763184da21778adf21c3c5c025dc10882abdf1b
#endif
#ifndef SKB_DUKPT_WORKING_KEY_USAGE_MESSAGE_AUTHENTICATION_GENERATION
    #define SKB_DUKPT_WORKING_KEY_USAGE_MESSAGE_AUTHENTICATION_GENERATION lce0a0e1acdbd3c61f6f64f8ad534c537bd75a3a7b7894b09
#endif
#ifndef SKB_DUKPT_WORKING_KEY_USAGE_MESSAGE_AUTHENTICATION_VERIFICATION
    #define SKB_DUKPT_WORKING_KEY_USAGE_MESSAGE_AUTHENTICATION_VERIFICATION l39f88faecb3bb254c9327e3747cbe4a4f94ed1a4ab316151
#endif
#ifndef SKB_DUKPT_WORKING_KEY_USAGE_PIN_ENCRYPTION
    #define SKB_DUKPT_WORKING_KEY_USAGE_PIN_ENCRYPTION l92f37340923bce3aa047dd7c0bdb75f2b80b81627ac41594
#endif
#ifndef SKB_DukptDerivationFunction
    #define SKB_DukptDerivationFunction l2c35101ea7a49343b153778dcb54ccc6d9a66913669142f6
#endif
#ifndef SKB_DukptKsnCompatibility
    #define SKB_DukptKsnCompatibility l2517464f68a4e963b1371a464861e11b471c83b661b352a6
#endif
#ifndef SKB_DukptState
    #define SKB_DukptState le390a1f97ef017618f6d581c77bd38515346583d045ac933
#endif
#ifndef SKB_DukptState_Create
    #define SKB_DukptState_Create l1072fd5f4d854623f1c03647ea64db29b3c0db73df0229ce
#endif
#ifndef SKB_DukptState_Derive
    #define SKB_DukptState_Derive l5b7c31bcbc64aea23ea029f9f322d91f434926aea8ffa127
#endif
#ifndef SKB_DukptState_Export
    #define SKB_DukptState_Export l323fce394cb25695d3cf9a6620141d161c2e5956ba67869d
#endif
#ifndef SKB_DukptState_Increment
    #define SKB_DukptState_Increment ldd4958a10b0802ea7100099ce8535c79ca9db82785a39a34
#endif
#ifndef SKB_DukptState_Release
    #define SKB_DukptState_Release l45632e77f8d387e6262e6996b537e7457b6286f87b338170
#endif
#ifndef SKB_DukptWorkingKeyType
    #define SKB_DukptWorkingKeyType l94d7600c3c6b68d87a8df0a609d958ebb9b06c4c150c7151
#endif
#ifndef SKB_DukptWorkingKeyUsage
    #define SKB_DukptWorkingKeyUsage l19a391cbb865289d4ed1f04fb59cfc1c425c65dbb0596ced
#endif
#ifndef SKB_Engine
    #define SKB_Engine l350d26f391b037d88e50bfcd33bb13404a551ba84b6eb30e
#endif
#ifndef SKB_Engine_ImportDukptState
    #define SKB_Engine_ImportDukptState l469932bd6819937348a68210be757c2bb5b373791bead20b
#endif
#ifndef SKB_ExportTarget
    #define SKB_ExportTarget l46dfeeb823e7c72634cd0142fc095e236fc1e25e78be1e44
#endif
#ifndef SKB_Result
    #define SKB_Result l769cdd4d75a535dc4ec65180e1c1de0d5ff65f5a41786f30
#endif
#ifndef SKB_SecureData
    #define SKB_SecureData l8f962bd4e178539de3646be4fb53725b8654bb70294b014b
#endif
#ifndef SKB_Size
    #define SKB_Size lee355d2126eb616f9c74edb4ad3255a07f296366146519ce
#endif
 

#pragma once

#include "SkbSecureKeyBox.h"

#if defined(__cplusplus)
extern "C" {
#endif

typedef struct SKB_DukptState SKB_DukptState;

typedef enum {
    SKB_DUKPT_DERIVATION_FUNCTION_AES128 = 0x2311A8F5,
    SKB_DUKPT_DERIVATION_FUNCTION_AES192 = 0x7E300734,
    SKB_DUKPT_DERIVATION_FUNCTION_AES256 = 0x4AB4BBA0
} SKB_DukptDerivationFunction;

typedef enum {
    SKB_DUKPT_WORKING_KEY_USAGE_KEY_ENCRYPTION_KEY = 0x0996456B,
    SKB_DUKPT_WORKING_KEY_USAGE_PIN_ENCRYPTION = 0x2F856388,
    SKB_DUKPT_WORKING_KEY_USAGE_MESSAGE_AUTHENTICATION_GENERATION = 0x6DAFD884,
    SKB_DUKPT_WORKING_KEY_USAGE_MESSAGE_AUTHENTICATION_VERIFICATION = 0x51102C11,
    SKB_DUKPT_WORKING_KEY_USAGE_MESSAGE_AUTHENTICATION_BOTHWAYS = 0x78114E7C,
    SKB_DUKPT_WORKING_KEY_USAGE_DATA_ENCRYPTION_ENCRYPT = 0x7B3C72CC,
    SKB_DUKPT_WORKING_KEY_USAGE_DATA_ENCRYPTION_DECRYPT = 0x6DB9C674,
    SKB_DUKPT_WORKING_KEY_USAGE_DATA_ENCRYPTION_BOTHWAYS = 0x5751AD6C,
    SKB_DUKPT_WORKING_KEY_USAGE_KEY_DERIVATION = 0x1478002E
} SKB_DukptWorkingKeyUsage;

typedef enum {
    SKB_DUKPT_WORKING_KEY_TYPE_AES128 = 0x0D8A8CAB,
    SKB_DUKPT_WORKING_KEY_TYPE_AES192 = 0x1EB20F40,
    SKB_DUKPT_WORKING_KEY_TYPE_AES256 = 0x7467A3C4,
    SKB_DUKPT_WORKING_KEY_TYPE_TDEA2 = 0x40AF589F,
    SKB_DUKPT_WORKING_KEY_TYPE_TDEA3 = 0x1E8287DD,
    SKB_DUKPT_WORKING_KEY_TYPE_HMAC128 = 0x374C6818,
    SKB_DUKPT_WORKING_KEY_TYPE_HMAC192 = 0x49B305DA,
    SKB_DUKPT_WORKING_KEY_TYPE_HMAC256 = 0x5C20222E
} SKB_DukptWorkingKeyType;

typedef enum {
    SKB_DUKPT_KSN_AES_MODE = 0x6E6F93FB,
    SKB_DUKPT_KSN_COMPATIBILITY_MODE = 0x731A5C7F  
} SKB_DukptKsnCompatibility;

SKB_EXPORT SKB_Result
SKB_DukptState_Create(const SKB_SecureData*       initial_key,
                      const SKB_Byte*             initial_key_id,
                      SKB_Size                    initial_key_id_size,
                      SKB_DukptDerivationFunction derivation_function,
                      SKB_DukptKsnCompatibility   ksn_compatibility,
                      SKB_DukptState**            dukpt_state);

SKB_EXPORT SKB_Result
SKB_DukptState_Derive(const SKB_DukptState*    dukpt_state,
                      SKB_DukptWorkingKeyUsage working_key_usage,
                      SKB_DukptWorkingKeyType  working_key_type,
                      SKB_Byte*                ksn,
                      SKB_Size*                ksn_size,
                      SKB_SecureData**         working_key);

SKB_EXPORT SKB_Result
SKB_DukptState_Increment(SKB_DukptState* dukpt_state);

SKB_EXPORT SKB_Result
SKB_DukptState_Export(const SKB_DukptState* dukpt_state,
                      SKB_ExportTarget      target,
                      SKB_Byte*             buffer,
                      SKB_Size*             buffer_size);

SKB_EXPORT SKB_Result
SKB_Engine_ImportDukptState(SKB_Engine*      self,
                            const SKB_Byte*  buffer,
                            SKB_Size         buffer_size,
                            SKB_DukptState** dukpt_state);

SKB_EXPORT SKB_Result
SKB_DukptState_Release(SKB_DukptState* dukpt_state);

#if defined(__cplusplus)
}
#endif
